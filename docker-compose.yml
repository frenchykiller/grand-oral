version: '3'

services:
    web:
        #restart: always
        environment:
            VIRTUAL_HOST: "${VIRTUAL_HOST:?err}"
            SELF_SIGNED_HOST: "${VIRTUAL_HOST:?err}"
        build:
            context: ./build/apache
            args:
                - ENV=${ENV:-dev}
                - UID=${UID:-1000}
                - PHP_VERSION=${PHP_VERSION:-7.2}
                - INSTALL_COMPOSER=${INSTALL_COMPOSER:-false}
                - INSTALL_NODE=${INSTALL_NODE:-false}
                - NODE_VERSION=${NODE_VERSION:-8}
                - INSTALL_IMAGE_OPTIMIZERS=${INSTALL_IMAGE_OPTIMIZERS:-false}
                - PHP_APC=${PHP_APC:-false}
                - PHP_BCMATH=${PHP_BCMATH:-false}
                - PHP_CALENDAR=${PHP_CALENDAR:-false}
                - PHP_CURL=${PHP_CURL:-false}
                - PHP_DOM=${PHP_DOM:-false}
                - PHP_EXIF=${PHP_EXIF:-false}
                - PHP_FILEINFO=${PHP_FILEINFO:-false}
                - PHP_GD=${PHP_GD:-false}
                - PHP_GMP=${PHP_GMP:-false}
                - PHP_IMAGICK=${PHP_IMAGICK:-false}
                - PHP_IMAP=${PHP_IMAP:-false}
                - PHP_INTL=${PHP_INTL:-false}
                - PHP_JSON=${PHP_JSON:-false}
                - PHP_LDAP=${PHP_LDAP:-false}
                - PHP_MBSTRING=${PHP_MBSTRING:-false}
                - PHP_MEMCACHED=${PHP_MEMCACHED:-false}
                - PHP_MONGO=${PHP_MONGO:-false}
                - PHP_MYSQL=${PHP_MYSQL:-false}
                - PHP_OPCACHE=${PHP_OPCACHE:-false}
                - PHP_PGSQL=${PHP_PGSQL:-false}
                - PHP_REDIS=${PHP_REDIS:-false}
                - PHP_SOAP=${PHP_SOAP:-false}
                - PHP_SQLITE3=${PHP_SQLITE3:-false}
                - PHP_XDEBUG=${PHP_XDEBUG:-false}
                - PHP_XML=${PHP_XML:-false}
                - PHP_ZIP=${PHP_ZIP:-false}
        volumes:
            - ./www:/var/www/app/public
            - ./data/composer:/var/www/.composer
            - ./data/npm:/var/www/.npm
        expose:
            - "80"
        networks:
            - proxy

    cron:
        #restart: always
        build: ./build/cron
        volumes:
            - /var/run/docker.sock:/var/run/docker.sock:ro

networks:
    proxy:
        external: true
